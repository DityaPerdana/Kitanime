extends layout

block content
  div(class="space-y-6")
    div(class="flex items-center justify-between")
      div
        h2(class="text-xl font-semibold text-white") Kelola API Endpoints
        p(class="text-white/70 mt-1") Atur URL API untuk mengambil data anime
      
      button(onclick="showAddModal()" class="bg-primary-600 text-neutral-100 px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium") Tambah Endpoint

    div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow overflow-hidden")
      div(class="px-6 py-4 border-b border-neutral-800")
        h3(class="font-medium text-white") Daftar API Endpoints
      
      if endpoints && endpoints.length > 0
        div(class="divide-y divide-neutral-800")
          each endpoint in endpoints
            div(class="px-6 py-4")
              div(class="flex items-center justify-between")
                div(class="flex-1")
                  div(class="flex items-center space-x-3")
                    h4(class="font-medium text-white")= endpoint.name
                    if endpoint.is_active
                      span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900/30 text-green-300 border border-green-700") Aktif
                    else
                      span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-neutral-800 text-neutral-300 border border-neutral-700") Tidak Aktif
                  
                  p(class="text-sm text-neutral-300 mt-1")= endpoint.url
                  p(class="text-xs text-neutral-400 mt-1") Dibuat: #{new Date(endpoint.created_at).toLocaleDateString('id-ID')}
                
                div(class="flex items-center space-x-2")
                  button(onclick=`editEndpoint(${endpoint.id}, '${endpoint.name}', '${endpoint.url}', ${endpoint.is_active})` class="text-primary-400 hover:text-primary-300 font-medium text-sm") Edit
                  button(onclick=`deleteEndpoint(${endpoint.id})` class="text-red-500 hover:text-red-400 font-medium text-sm") Hapus

      else
        div(class="px-6 py-8 text-center")
          svg(class="w-12 h-12 text-neutral-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z")
          h3(class="text-lg font-medium text-white mb-2") Belum ada endpoint
          p(class="text-neutral-400") Tambah endpoint API untuk mulai menggunakan sistem

    div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow p-6")
      h3(class="font-medium text-white mb-4") Test Koneksi API
      div(class="flex items-center space-x-4")
        button(onclick="testConnection()" class="bg-primary-600 text-neutral-100 px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium") Test Koneksi
        div(id="connectionStatus" class="text-sm text-neutral-400") Klik tombol untuk test koneksi

  div(id="endpointModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50")
    div(class="flex items-center justify-center min-h-screen p-4")
      div(class="bg-neutral-900 text-white rounded-lg shadow-xl max-w-md w-full border border-neutral-800")
        form(id="endpointForm" method="POST")
          div(class="px-6 py-4 border-b border-neutral-800")
            h3(id="modalTitle" class="text-lg font-medium text-white") Tambah Endpoint
          
          div(class="px-6 py-4 space-y-4")
            div
              label(class="block text-sm font-medium text-white mb-1") Nama Endpoint
              input(type="text" name="name" id="endpointName" required class="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-100 placeholder-neutral-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Contoh: API Utama")
            
            div
              label(class="block text-sm font-medium text-white mb-1") URL API
              input(type="url" name="url" id="endpointUrl" required class="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-100 placeholder-neutral-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="https://api.example.com/v1")
            
            div
              label(class="flex items-center")
                input(type="checkbox" name="is_active" id="endpointActive" class="rounded border-neutral-600 bg-neutral-800 text-primary-600 focus:ring-primary-500")
                span(class="ml-2 text-sm text-neutral-200") Aktifkan endpoint ini
          
          div(class="px-6 py-4 border-t border-neutral-800 flex justify-end space-x-3")
            button(type="button" onclick="closeModal()" class="px-4 py-2 text-white bg-neutral-800 rounded-lg hover:bg-neutral-700 transition-colors") Batal
            button(type="submit" class="px-4 py-2 bg-primary-600 text-neutral-100 rounded-lg hover:bg-primary-700 transition-colors") Simpan

block scripts
  script.
    let editingId = null;

    function showAddModal() {
      document.getElementById('modalTitle').textContent = 'Tambah Endpoint';
      document.getElementById('endpointForm').action = '/admin/api-endpoints';
      document.getElementById('endpointName').value = '';
      document.getElementById('endpointUrl').value = '';
      document.getElementById('endpointActive').checked = false;
      editingId = null;
      document.getElementById('endpointModal').classList.remove('hidden');
    }

    function editEndpoint(id, name, url, isActive) {
      document.getElementById('modalTitle').textContent = 'Edit Endpoint';
      document.getElementById('endpointForm').action = `/admin/api-endpoints/${id}`;
      document.getElementById('endpointName').value = name;
      document.getElementById('endpointUrl').value = url;
      document.getElementById('endpointActive').checked = isActive;
      editingId = id;
      document.getElementById('endpointModal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('endpointModal').classList.add('hidden');
    }

    function deleteEndpoint(id) {
      if (confirm('Apakah Anda yakin ingin menghapus endpoint ini?')) {
        fetch(`/admin/api-endpoints/${id}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload();
          } else {
            alert('Gagal menghapus endpoint');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Terjadi kesalahan');
        });
      }
    }

    async function testConnection() {
      const statusEl = document.getElementById('connectionStatus');
      statusEl.textContent = 'Menguji koneksi...';
      statusEl.className = 'text-sm text-neutral-300';

      try {
        const response = await fetch('/api/');
        const data = await response.json();
        
        if (data.success) {
          statusEl.textContent = 'Koneksi berhasil!';
          statusEl.className = 'text-sm text-green-400';
        } else {
          statusEl.textContent = 'Koneksi gagal: ' + (data.error || 'Unknown error');
          statusEl.className = 'text-sm text-red-400';
        }
      } catch (error) {
        statusEl.textContent = 'Koneksi gagal: ' + error.message;
        statusEl.className = 'text-sm text-red-400';
      }
    }

    document.getElementById('endpointModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
