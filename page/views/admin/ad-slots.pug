extends layout

block content
  div(class="space-y-6")
    div(class="flex items-center justify-between")
      div
        h2(class="text-2xl font-bold text-white tracking-tight") Kelola Slot Iklan
        p(class="text-white mt-1") Tambah, edit, atau hapus slot iklan di website
      
      button(onclick="showAddModal()" class="inline-flex items-center gap-2 bg-primary-600 text-neutral-100 px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium shadow-sm")
        svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
          path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4")
        | Tambah Slot Iklan

    div(class="bg-neutral-900 border border-neutral-800 rounded-xl shadow overflow-hidden")
      div(class="px-6 py-4 border-b border-neutral-800/80 bg-neutral-950/40 backdrop-blur-sm")
        h3(class="font-semibold text-white") Daftar Slot Iklan
      
      if adSlots && adSlots.length > 0
        div(class="divide-y divide-neutral-800/80")
          each slot in adSlots
            div(class="px-6 py-4")
              div(class="flex items-start justify-between gap-6")
                div(class="flex-1 min-w-0")
                  div(class="flex flex-wrap items-center gap-2 mb-2")
                    h4(class="font-medium text-white truncate")= slot.name
                    if slot.is_active
                      span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900/30 text-white border border-green-700") Aktif
                    else
                      span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-neutral-800 text-white border border-neutral-700") Tidak Aktif
                    
                    case slot.type
                      when 'adsense'
                        span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-900/30 text-white border border-blue-700") AdSense
                      when 'banner'
                        span(class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-900/30 text-white border border-purple-700") Banner
                  
                  div(class="flex flex-wrap items-center gap-3 text-sm text-white mb-2")
                    span(class="inline-flex items-center gap-1")
                      svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3")
                      | Posisi: #{slot.position}
                    span(class="inline-flex items-center gap-1")
                      svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2v-7H3v7a2 2 0 002 2z")
                      | #{new Date(slot.created_at).toLocaleDateString('id-ID')}
                  
                  if slot.content
                    div(class="mt-2 flex items-start gap-2")
                      pre(class="flex-1 p-2 bg-neutral-950/60 border border-neutral-800 rounded text-xs text-white max-h-20 overflow-auto whitespace-pre-wrap font-mono") #{slot.content.substring(0, 100)}...
                      button(type="button" class="shrink-0 px-2 py-1 rounded bg-neutral-800 text-white text-xs hover:bg-neutral-700 transition-colors copy-btn" data-content=slot.content) Salin
                
                div(class="flex items-center gap-2")
                  button(onclick=`editSlot(${slot.id}, '${slot.name && slot.name.replace(/'/g, "\\'")}', '${slot.position && slot.position.replace(/'/g, "\\'")}', '${slot.type && slot.type.replace(/'/g, "\\'")}', \`${(slot.content || '').replace(/`/g, '\\`').replace(/\$\{/g, '\\${')}\`, ${slot.is_active})` class="inline-flex items-center gap-1 text-white hover:text-white font-medium text-sm px-2 py-1 rounded hover:bg-primary-900/20 transition-colors")
                    svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h2m-1 14v-7m0 0l-2 2m2-2l2 2M5 7l2-2a2 2 0 012 0l8 8a2 2 0 010 2l-2 2a2 2 0 01-2 0L5 9a2 2 0 010-2z")
                    | Edit
                  button(onclick=`deleteSlot(${slot.id})` class="inline-flex items-center gap-1 text-white hover:text-white font-medium text-sm px-2 py-1 rounded hover:bg-red-900/20 transition-colors")
                    svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                      path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0a2 2 0 012-2h2a2 2 0 012 2m-7 0h8")
                    | Hapus

      else
        div(class="px-6 py-12 text-center")
          svg(class="w-12 h-12 text-white mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10")
          h3(class="text-lg font-semibold text-white mb-2") Belum ada slot iklan
          p(class="text-white") Tambah slot iklan untuk mulai menampilkan iklan di website

    div(class="bg-neutral-900 border border-neutral-800 rounded-xl p-6")
      h3(class="font-semibold text-white mb-3") Posisi Slot Iklan
      div(class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-white")
        div
          h4(class="font-medium mb-2") Posisi Tersedia:
          ul(class="space-y-1 list-disc list-inside marker:text-blue-400/70")
            li header - Di bagian header website
            li sidebar-top - Di bagian atas sidebar
            li sidebar-bottom - Di bagian bawah sidebar
            li content-bottom - Di bawah konten utama
            li player-bottom - Di bawah video player

  div(id="slotModal" class="fixed inset-0 bg-black/60 hidden z-50")
    div(class="flex items-center justify-center min-h-screen p-4")
      div(class="relative bg-neutral-900 border border-neutral-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden")
        // Titlebar
        div(class="px-6 py-4 border-b border-neutral-800 bg-neutral-950/40 backdrop-blur-sm flex items-center justify-between")
          h3(id="modalTitle" class="text-lg font-semibold text-white") Tambah Slot Iklan
          button(type="button" onclick="closeModal()" class="p-2 rounded hover:bg-neutral-800 text-neutral-300 hover:text-neutral-100 transition-colors")
            svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12")
        
        form(id="slotForm" method="POST" class="px-6 py-4 space-y-4")
          div
            label(class="block text-sm font-medium text-white mb-1") Nama Slot
            input(type="text" name="name" id="slotName" required class="w-full px-3 py-2 bg-neutral-900 border border-neutral-700 text-white rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Contoh: Header Banner")
          
          div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
            div
              label(class="block text-sm font-medium text-white mb-1") Posisi
              select(name="position" id="slotPosition" required class="w-full px-3 py-2 bg-neutral-900 border border-neutral-700 text-white rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent")
                option(value="") Pilih posisi
                option(value="header") Header
                option(value="sidebar-top") Sidebar Top
                option(value="sidebar-bottom") Sidebar Bottom
                option(value="content-bottom") Content Bottom
                option(value="player-bottom") Player Bottom
            
            div
              label(class="block text-sm font-medium text-white mb-1") Tipe Iklan
              select(name="type" id="slotType" required onchange="toggleContentType()" class="w-full px-3 py-2 bg-neutral-900 border border-neutral-700 text-white rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent")
                option(value="") Pilih tipe
                option(value="adsense") Google AdSense
                option(value="banner") Banner Manual
          
          div
            label(class="block text-sm font-medium text-white mb-1") Konten Iklan
            textarea(name="content" id="slotContent" required rows="6" class="w-full px-3 py-2 bg-neutral-900 border border-neutral-700 text-white rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Masukkan kode AdSense atau HTML banner")
            div(id="contentHelp" class="mt-1 text-xs text-white")
              span(id="adsenseHelp" style="display: none") Paste kode AdSense yang diberikan oleh Google
              span(id="bannerHelp" style="display: none") Masukkan HTML untuk banner (img tag, link, dll)
          
          div
            label(class="flex items-center select-none cursor-pointer")
              input(type="checkbox" name="is_active" id="slotActive" class="rounded bg-neutral-900 border-neutral-700 text-primary-600 focus:ring-primary-500")
              span(class="ml-2 text-sm text-white") Aktifkan slot iklan ini
          
          div(class="pt-4 border-t border-neutral-800 flex justify-end gap-3")
            button(type="button" onclick="closeModal()" class="px-4 py-2 text-white bg-neutral-800 rounded-lg hover:bg-neutral-700 transition-colors") Batal
            button(type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors") Simpan

block scripts
  script.
    let editingId = null;

    function showAddModal() {
      document.getElementById('modalTitle').textContent = 'Tambah Slot Iklan';
      document.getElementById('slotForm').action = '/admin/ad-slots';
      document.getElementById('slotName').value = '';
      document.getElementById('slotPosition').value = '';
      document.getElementById('slotType').value = '';
      document.getElementById('slotContent').value = '';
      document.getElementById('slotActive').checked = true;
      editingId = null;
      document.getElementById('slotModal').classList.remove('hidden');
    }

    function editSlot(id, name, position, type, content, isActive) {
      document.getElementById('modalTitle').textContent = 'Edit Slot Iklan';
      document.getElementById('slotForm').action = `/admin/ad-slots/${id}`;
      document.getElementById('slotName').value = name;
      document.getElementById('slotPosition').value = position;
      document.getElementById('slotType').value = type;
      document.getElementById('slotContent').value = content;
      document.getElementById('slotActive').checked = isActive;
      editingId = id;
      toggleContentType();
      document.getElementById('slotModal').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('slotModal').classList.add('hidden');
    }

    function deleteSlot(id) {
      if (confirm('Apakah Anda yakin ingin menghapus slot iklan ini?')) {
        fetch(`/admin/ad-slots/${id}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload();
          } else {
            alert('Gagal menghapus slot iklan');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Terjadi kesalahan');
        });
      }
    }

    function toggleContentType() {
      const type = document.getElementById('slotType').value;
      const adsenseHelp = document.getElementById('adsenseHelp');
      const bannerHelp = document.getElementById('bannerHelp');
      const contentTextarea = document.getElementById('slotContent');

      if (type === 'adsense') {
        adsenseHelp.style.display = 'inline';
        bannerHelp.style.display = 'none';
        contentTextarea.placeholder = 'Paste kode AdSense di sini...';
      } else if (type === 'banner') {
        adsenseHelp.style.display = 'none';
        bannerHelp.style.display = 'inline';
        contentTextarea.placeholder = '<img src="banner.jpg" alt="Advertisement" class="w-full h-auto">';
      } else {
        adsenseHelp.style.display = 'none';
        bannerHelp.style.display = 'none';
        contentTextarea.placeholder = 'Masukkan kode AdSense atau HTML banner';
      }
    }

    // Close modal when clicking backdrop
    document.getElementById('slotModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Copy content handler
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.copy-btn');
      if (!btn) return;
      const content = btn.getAttribute('data-content') || '';
      navigator.clipboard.writeText(content).then(() => {
        const prev = btn.textContent;
        btn.textContent = 'Disalin';
        setTimeout(() => { btn.textContent = prev; }, 1200);
      }).catch(() => {
        alert('Gagal menyalin konten');
      });
    });
