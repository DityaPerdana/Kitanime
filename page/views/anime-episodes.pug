extends layout

block content
  div(class="container mx-auto px-4 py-6")
    div(class="grid grid-cols-1 lg:grid-cols-4 gap-8")
      div(class="lg:col-span-3")
        nav(class="mb-4")
          ol(class="flex items-center space-x-2 text-sm text-white")
            li: a(href="/" class="hover:underline decoration-primary-600/70") Beranda
            li: span /
            li: a(href=`/anime/${anime.slug}` class="hover:underline decoration-primary-600/70")= anime.title
            li: span /
            li(class="text-white font-medium") Episode List

        div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow-sm p-6 mb-6")
          div(class="flex items-start space-x-4")
            img(src=anime.poster alt=anime.title class="w-24 h-32 object-cover rounded-lg flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=No+Image';")
            div(class="flex-1")
              h1(class="text-xl md:text-2xl font-bold text-white mb-2")= `Episode ${anime.title}`
              if anime.synopsis
                p(class="text-white text-sm leading-relaxed line-clamp-3")= anime.synopsis
              div(class="flex items-center space-x-4 mt-4")
                a(href=`/anime/${anime.slug}` class="text-white underline decoration-primary-600/60 hover:decoration-primary-600 font-medium text-sm") â† Kembali ke Detail
                if episodes && episodes.length > 0
                  span(class="text-sm text-white")= `${episodes.length} Episode`

        if episodes && episodes.length > 0
          div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow-sm p-6 mb-6")
            h2(class="text-lg font-bold text-white mb-4") Daftar Episode
            div(class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3")
              each episode in episodes
                a(href=`/anime/${anime.slug}/episode/${episode.episode}` class="episode-card bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 hover:border-neutral-600 rounded-lg p-3 text-center transition-colors group")
                  div(class="text-sm font-medium text-white") Episode #{episode.episode}
                  if episode.release_date
                    div(class="text-xs text-white mt-1")= episode.release_date
                  if episode.duration
                    div(class="text-xs text-white mt-1")= episode.duration

        else
          div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow-sm p-6 mb-6")
            div(class="text-center py-8")
              svg(class="w-12 h-12 text-white mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z")
              h3(class="text-lg font-medium text-white mb-2") Belum ada episode
              p(class="text-white") Episode untuk anime ini belum tersedia

        if adSlots && adSlots.contentBottom && adSlots.contentBottom.length > 0
          div(class="mb-6")
            each ad in adSlots.contentBottom
              div(class="ad-slot bg-neutral-900 border border-neutral-800 rounded-lg text-white")!= ad.content

      div(class="lg:col-span-1")
        if adSlots && adSlots.sidebarTop && adSlots.sidebarTop.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarTop
              div(class="ad-slot bg-neutral-900 border border-neutral-800 rounded-lg text-white")!= ad.content

        div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow-sm p-6 mb-6")
          h3(class="font-bold text-white mb-4") Informasi Anime
          div(class="space-y-3 text-sm")
            if anime.title
              div
                span(class="font-medium text-white") Judul:
                span(class="text-white ml-2")= anime.title
            if anime.status
              div
                span(class="font-medium text-white") Status:
                span(class="text-white ml-2")= anime.status
            if anime.release_year
              div
                span(class="font-medium text-white") Tahun:
                span(class="text-white ml-2")= anime.release_year
            if episodes && episodes.length > 0
              div
                span(class="font-medium text-white") Total Episode:
                span(class="text-white ml-2")= episodes.length

        div(class="bg-neutral-900 border border-neutral-800 rounded-lg shadow-sm p-6 mb-6")
          h3(class="font-bold text-white mb-4") Aksi Cepat
          div(class="space-y-3")
            a(href=`/anime/${anime.slug}` class="flex items-center text-white hover:underline decoration-primary-600/60 transition-colors")
              svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
              span Detail Anime
            if episodes && episodes.length > 0
              a(href=`/anime/${anime.slug}/episode/${episodes[0].episode === 0 ? 1 : episodes[0].episode}` class="flex items-center text-white hover:underline decoration-primary-600/60 transition-colors")
                svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-9-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
                span Mulai Nonton
            if anime.batch_links && anime.batch_links.length > 0
              a(href=`/anime/${anime.slug}/batch` class="flex items-center text-white hover:underline decoration-primary-600/60 transition-colors")
                svg(class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z")
                span Download Batch

        if adSlots && adSlots.sidebarBottom && adSlots.sidebarBottom.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarBottom
              div(class="ad-slot bg-neutral-900 border border-neutral-800 rounded-lg text-white")!= ad.content

block scripts
  script.
    if ('IntersectionObserver' in window) {
      const episodeObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-fadeIn');
            episodeObserver.unobserve(entry.target);
          }
        });
      });

      document.querySelectorAll('.episode-card').forEach(card => {
        episodeObserver.observe(card);
      });
    }
